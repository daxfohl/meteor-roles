<head>
  <title>Midwest Listings</title>
</head>

<body>
</body>

<template name="layout">
  {{> header}}

  {{> yield}}

  <!--suppress XmlDuplicatedId -->
  <div id="log"></div>
</template>

<template name="layout_no_header">
  {{> yield}}

  <!--suppress XmlDuplicatedId -->
  <div id="log"></div>
</template>

<template name="signin">
  <div class="signin">
    <div class="login-form">
      <h1>Sign In</h1>
      {{> loginButtons}}
    </div>

    <div class="example-users">
      <p>Normal User: normal@example.com | apple1</p>
      <p>View Listings: view@example.com | apple1</p>
      <p>Manage Users: manage@example.com | apple1</p>
      <p>Admin User: admin@example.com | apple1</p>
    </div>
  </div>
</template>

<template name="loading">
  <h1>Loading...</h1>
</template>

<template name="not_found">
  <h3>404 - Not found</h3>
</template>

<template name="invalid-access">
  <h3>403 Forbidden - Invalid Access</h3>
</template>

<template name="header">
  <div class="navbar navbar-inverse navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <a class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
        <a class="brand" href="/">Midwest Listings</a>
        <div class="nav-collapse collapse">
          <ul class="nav">
            <li><a href="/listings">Listings</a></li>
            {{#if isInRole 'admin,manage-users'}}
            <li><a href="/manage">Manage Users</a></li>
            {{/if}}

            <li class="dropdown pull-right">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">{{displayName}}<b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="/changePassword">Change Password</a></li>
                <li><a class="signout" href="/signout">Sign out</a></li>
              </ul>
            </li>

          </ul>
        </div>
      </div>
    </div>
  </div>
</template>

<template name="listings">
  <div class="listings row">
    <div class="offset4 span8">
      <h2>Listings!</h2>
      <ul>
      {{#each listings}}
        <li><p><a href="{{ pathFor 'editListing' id=this._id}}">{{address}}</a>{{agent}}</p></li>
      {{/each}}
      </ul>
      <a href="{{ pathFor 'createListing' }}">Create</a>
    </div>
  </div>
</template>

<template name="createListing">
  {{> quickForm collection="Listings" id="createListingForm" type="insert"}}
</template>

<template name="editListing">
  {{> quickForm collection="Listings" doc=listing id="editListingForm" type="update"}}
</template>

<template name="manage">
  <div class="manage-users row">
    <div class="offset4 span8">
      <h2>Manage Users</h2>
      <br />
      <h3>Current Users</h3>
      <ul>
      {{#each users}}
        <li><p>{{email}} [{{roles}}] /
          <a href="{{ pathFor 'editUser' id=this._id}}">Edit</a> /
          <a href="{{ pathFor 'adminChangePwd' id=this._id}}">Change Pwd</a> /
          <a href="{{ pathFor 'deleteUser' id=this._id}}">Delete</a></p></li>
      {{/each}}
      </ul>
      <a href="{{ pathFor 'createUser' }}">Create</a>
    </div>
  </div>
</template>

<template name="createUser">
  {{> quickForm schema="NewUserSchema" id="createUserForm" type="method" meteormethod="newUser"}}
</template>

<template name="editUser">
  {{#autoForm schema="EditUserSchema" doc=user id="editUserForm" type="method" meteormethod="editUser"}}
  <fieldset>
    <legend>Edit User</legend>
    {{> afQuickField name='id' readonly='true'}}
    {{> afQuickField name='email'}}
    {{> afQuickField name='isAdmin'}}
  </fieldset>
  <button type="submit" class="btn btn-primary">Edit</button>
  {{/autoForm}}
</template>

<template name="adminChangePwd">
  {{#autoForm schema="AdminChangePasswordSchema" doc=user id="adminChangePwdForm" type="method" meteormethod="adminChangePwd"}}
  <fieldset>
    <legend>Update Password</legend>
    {{> afQuickField name='userId' readonly='true'}}
    {{> afQuickField name='userEmail' readonly='true'}}
    {{> afQuickField name='newPassword'}}
    {{> afQuickField name='confirmPassword'}}
  </fieldset>
  <button type="submit" class="btn btn-primary">Update</button>
  {{/autoForm}}
</template>

<template name="deleteUser">
  {{#autoForm schema="DeleteUserSchema" doc=user id="deleteUserForm" type="method" meteormethod="deleteUser"}}
  <fieldset>
    <legend>Delete User</legend>
    {{> afQuickField name='id' readonly='true'}}
    {{> afQuickField name='email' readonly='true'}}
  </fieldset>
  <button type="submit" class="btn btn-primary">Delete</button>
  {{/autoForm}}
</template>